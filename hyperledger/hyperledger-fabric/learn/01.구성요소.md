# 하이퍼레저 구성요소  

- <a href="#peer">Peer</div>  
- <a href="#chaincode">Chaincode</div>  
- <a href="#dapp">Dapp</div>  
- <a href="#endorsement_policy">Endorsement Policy</div>  

---  

<div id="peer"></div>  

## Peer  
=> 패브릭 블록체인을 구성하는 네트워크 노드 중 하나  
=> 분산원장과 스마트 컨트랙트를 관리하는 역할  

![peers](./pics/peers.png)  

1. 분산원장과 체인코드는 peer에 저장되고 설치되기 때문에 peer를 통해서만 분장원장과  
체인 코드에 접근할 수 있음  

2. 분산원장에 접근 가능한 체인코드가 없는 경우도 가능하지만, 권장하지 않는 설정  
=> 하나의 peer는 최소 한 개 이상의 분산원장과 체인코드 호스팅을 권장  

3. 필요에 따라 peer는 복수 개의 분산원장과 체인코드를 가질 수 있음  
(위는 2개의 분산원장과 3개의 체인코드를 각각 호스팅)  

4. peer1은 체인코드1과 분산원장1을 호스팅.  
peer2는 체인코드2와 분산원장1, 분산원장2를 호스팅  
=> 사용자A는 peer1에 연결되어 있으며 체인코드1을 통해 데이터를 READ/WRITE  
=> 사용자B는 peer2에 연결되어 있으며 체인코드2를 통해 분산원장1과 분산원장2에  
모두 접근 가능.

---  

<div id="chaincode"></div>  

## Chaincode  
; 분산원장에 데이터를 기록하거나 읽기 위해서 체인코드(chaincode)가 필요  
=> 주로 비즈니스 모델에 맞는 분산 애플리케이션(DApp)과 함께 개발되어 사용  

- 시스템 체인코드(System chaincode)  
; 일반적인 체인코드와는 달리 하이퍼레저 패브릭의 시스템레벨에서 수행되는 체인코드  
=> 시스템 체인코드는 하이퍼레저 패브릭 상에서 기본적으로 제공하는 체인코드이며,  
5가지 종류가 존재  

1. QSCC(Query System ChainCode)  
; 블록체인의 저장된 데이터를 읽어올 때 사용되는 시스템 체인코드  
e.g) GetChainInfo, GetTransactionByID, ...  

2. ESCC(Endorsement System ChainCode)  
; 보증 정책을 담당하는 시스템 체인코드  
=> 사용자의 트랜잭션 실행 결괏값을 비교해 올바르면 자신의 인증서를 통해  
해당 트랜잭션 결괏값에 대한 보증을 함  

3. VSCC(Validation System ChainCode)   
; 블록을 검증할 때 사용되는 시스템 체인코드  
=> Committing peer는 VSCC를 실행하여 트랜잭션의 Read/Write Set과 보증 정책에  
맞게 Endorsing peer의 디지털 인증서의 존재 여부를 확인하는 작업을 수행  
(기본적으로 시스템에서 제공하는 VSCC 체인코드를 사용하지만, 수정해서 사용할 수 있음)  

4. CSCC(Configuration System ChainCode)  
; 채널 설정 시 사용되는 시스템 체인코드  
=> 블록에 대한 정보를 읽어오거나 수정할 수 있으며 peer를 채널에 참여시키는 기능  
등을 제공.  
=> 사용자에게 꼭 결과값을 반환 할 필요X
(peer channel create/join/...)  


5. LSCC(Lifecycle System ChainCode)  
; 체인코드의 설치부터 인스턴스화까지 모든 일련의 과정을 수행하는 데 사용되는 체인코드  
=> 사용자에게 꼭 결과값을 반환 할 필요X  
e.g) peer chaincode install/instantiate  

---  

<div id="dapp"></div>  

## Dapp  
; 체인코드는 그 자체로도 사용가능하지만, 비즈니스 모델에 맞는 분산 애플리케이션(dapp)  
과 함께 개발되어 사용됨  

![dapp 네트워크 연동 개념도](./pics/concept_dapp.png)  
=> 사용자A는 DApp을 통해 peer 네트워크에 설치 된 체인코드를 실행할 수 있음  
=> 체인코드 기능은 크게 읽기(query) / 쓰기(write/update) 두 종류의 함수로 구분  
=> 읽기 함수는 5단계 과정 / 쓰기 함수는 9단계 과정을 거쳐서 실행 됨  
=> 읽기는 작업을 수행함과 동시에 결괏값을 수신받을 수 있지만, 쓰기는 일정 시간이  
경과된 후에야 결괏값이 반영  

![dapp 데이터 읽기 과정](./pics/read_dapp.png)  
=> 사용자A의 인증서를 이용해서 인증 과정을 통과한 후 peer와 연결  
=> peer에 설치 된 체인코드의 query 함수를 호출  
=> peer는 요청 받은 체인코드의 query 함수를 실행하여 로컬 저장소에 저장되어 있는  
분산원장의 데이터를 분산 애플리케이션에 전달  
=> 다른 peer는 query 함수 실행을 위한 어떠한 동작도 하지 않음  

![dapp 업데이트 과정](./pics/update_dapp.png)  
=> read와 달리 peer 간 합의 과정이 필요하기 때문에 모든 peer가 쓰기 과정에  
참여해야 함  
=> 1~4단계는 read와 같음  

![peer의 디지털 인증서와 트랜잭션 시뮬레이션 결괏값 전달](./pics/update5_dapp.png)  
=> 5단계에서는 peer1이 트랜잭션 입력값에 대한 결괏값과 보증 정책을 확인하는 작업을  
수행  
=> 트랜잭션 실행 결괏값이 정상적이고 peer1의 보증 조건을 충족시키면,  
peer1은 결괏값과 함께 peer1의 디지털 인증서를 분산 애플리케이션에 전달  


![최신 블록 전파](./pics/update_propagation_dapp.png)  
=> DApp은 트랜잭션 결괏값과 peer1의 디지털 인증서와 함께 트랜잭션을 orderer로 전송  
=> orderer 노드는 자신이 속한 네트워크에서 발생한 모든 트랜잭션을 수신하게 됨  
=> orderer 노드는 수신한 트랜잭션을 순서에 맞게 정렬하여 블록체인의 최신 블록 생성  
후 자신이 속한 네트워크의 모든 peer에게 전달  


![업데이트 완료 알림 과정](./pics/update_notify_dapp.png)  
=> 최신 블록을 전달받은 모든 peer는 해당 블록에 포함 된 모든 트랜잭션에 대한 결괏값과  
인증서를 검증하는 작업을 수행  
=> 검증 과정에서 문제가 없을 시 자신의 로컬 저장소에 저장된 분산원장을 업데이트  
=> peer는 블록 업데이트 결과를 DApp에게 알려주는 것으로 업데이트 과정이 끝  

---  

<div id="endorsement_policy"></div>

## Endorsement Policy



















---  

## Reference  

- https://book.naver.com/bookdb/book_detail.nhn?bid=14204645  
- https://hyperledger-fabric.readthedocs.io/en/release-1.3/


---  

<br /><br /><br /><br /><br /><br />
