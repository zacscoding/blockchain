# 네트워크 구축

![네트워크 예제](./pics/fabric_ca_network_example.png)  

## Index  

- <a href="#hostname">Hostname 설정</a>  
- <a href="#install_ca">fabric-ca 설치</a>
- <a href="#ca-admin-create">Fabric-CA 서버 실행 및 서버의 운영자 계정 생성</a>  
- <a href="#ca-server-admin-create-msp">Fabric-CA 서버 운영자 MSP 생성</a>  
- <a href="#organization_create">조직 생성 및 조직 운영자 MSP 생성</a>  
- <a href="#peer_orderer_msp_create">Peer 및 Orderer 노드 MSP 생성  </a>  
- <a href="#running_orderer">Orderer 구동</a>  
- <a href="#running_peer">Peer 구동</a>  
- <a href="#generate_channel">채널 생성</a>  
- <a href="#join_channel">채널 참여</a>  
- <a href="#update_anchor_peer">Anchor peer 업데이트</a>  
- <a href="#install_chaincode">체인코드 설치</a>  
- <a href="#instantiate_channel">체인코드 인스턴스 생성</a>  
- <a href="#read_ledger">분산원장의 데이터 읽기</a>  
- <a href="#write_ledger">분산원장의 데이터 기록</a>  

---  

<div id="hostname"></div>  

## Hostname 설정  

> vi /etc/hostname  

```
peer0
```  

> check  

```
hostname
```

> vi /etc/hosts  

```
127.0.0.1       localhost
127.0.1.1       ubuntu

# Hyperledger
192.168.5.11  peer0
192.168.5.12  peer1
192.168.5.21  peer2
192.168.5.22  peer3

192.168.5.31  orderer0
192.168.5.32  kafka-zookeeper

192.168.5.13 admin@org0
192.168.5.23 admin@org1
192.168.5.33 admin@ordererorg0
```

---  

<div id="install_ca"></div>  

## fabric-ca 설치  

> 소스 다운로드 및 컴파일

```
root@ubuntu:~/gopath# cd $GOPATH/src/github.com/hyperledger
root@ubuntu:~/gopath/src/github.com/hyperledger# git clone -b release-1.3 https://github.com/hyperledger/fabric-ca
Cloning into 'fabric-ca'...
root@ubuntu:~/gopath/src/github.com/hyperledger# cd fabric-ca
root@ubuntu:~/gopath/src/github.com/hyperledger# make fabric-ca-server
root@ubuntu:~/gopath/src/github.com/hyperledger# make fabric-ca-client
```   

> 환경변수 등록(/etc/profile)  

```
# hyperledger fabric-ca
export PATH=$PATH:$GOPATH/src/github.com/hyperledger/fabric-ca/bin
```  

```
root@ubuntu:~/gopath/src/github.com/hyperledger/fabric-ca# source /etc/profile
```  

---  

<div id="ca-admin-create"></div>  

## Fabric-CA 서버 실행 및 서버의 운영자 계정 생성  

> Fabric-ca 설정파일 저장 경로 설정(Fabric-ca 노드에서 실행)  

```
root@ubuntu:~# vi /etc/profile


export FABRIC_CA_SERVER_HOME=/root/testnet/
```  

> Fabric-CA 서버 구동  

```
root@ubuntu:~# fabric-ca-server start -b admin:adminpw --cfg.affiliations.allowremove --cfg.identities.allowremove -d
```  

- **-b admin:adminpw**  
; Fabric-CA 서버 운영자 id:password
- **--cfg.affiliations.allowremove**  
; Fabric-CA 서버 운영자에게 조직을 추가하고 삭제하는 권한 부여
- **--cfg.identities.allowremove**  
; Fabric-CA 서버 운영자에게 사용자 계정을 추가하고 삭제하는 권한 부여  
- **-d**  
; Fabric-CA 서버의 상세 로그 표시  

---  

<div id="ca-server-admin-create-msp"></div>

## Fabric-CA 서버 운영자 MSP 생성  
=> admin@ordererorg0 노드에게 Fabric-CA 서버 운영자 권한 부여  

> Fabric-CA 클라이언트 설정파일 저장 경로 설정(admin@ordererorg0에서 실행)  

```
#root@ubuntu:~/gopath/src/github.com/hyperledger/fabric-ca# vi /etc/profile

export FABRIC_CA_CLIENT_HOME=/root/testnet/

root@ubuntu:~/gopath/src/github.com/hyperledger/fabric-ca# source /etc/profile
```  

> Fabric-CA 운영자 권한 횐득(admin@ordererorg0에서 실행)  

```
root@adminordererorg0:~# fabric-ca-client enroll -u http://admin:adminpw@192.168.5.41:7054
2019/02/20 20:23:34 [INFO] Created a default configuration file at /root/testnet/fabric-ca-client-config.yaml
2019/02/20 20:23:34 [INFO] generating key: &{A:ecdsa S:256}
2019/02/20 20:23:34 [INFO] encoded CSR
2019/02/20 20:23:34 [INFO] Stored client certificate at /root/testnet/msp/signcerts/cert.pem
2019/02/20 20:23:34 [INFO] Stored root CA certificate at /root/testnet/msp/cacerts/192-168-5-41-7054.pem
2019/02/20 20:23:34 [INFO] Stored Issuer public key at /root/testnet/msp/IssuerPublicKey
2019/02/20 20:23:34 [INFO] Stored Issuer revocation public key at /root/testnet/msp/IssuerRevocationPublicKey
root@adminordererorg0:~#
root@adminordererorg0:~# cd $FABRIC_CA_CLIENT_HOME
root@adminordererorg0:~/testnet# ll
total 64
drwxr-xr-x 3 root root  4096 Feb 20 20:23 ./
drwx------ 7 root root  4096 Feb 20 20:23 ../
-rw-r--r-- 1 root root 29395 Jan 15 00:21 core.yaml
-rwxr-xr-x 1 root root  6559 Feb 20 20:23 fabric-ca-client-config.yaml*
drwx------ 6 root root  4096 Feb 20 20:23 msp/
-rw-r--r-- 1 root root 11662 Jan 15 00:21 orderer.yaml
```  

- **-u**  
; MSP를 가져올 서버의 주소 (ID:PASSWORD@Fabric-CA서버주소)  
- **fabric-ca-client-config.yaml**  
; 클라이언트 설정이 담긴 파일 -> Fabric-CA 서버의 주소, MSP 경로, tls 설정 등  
- **msp**  
; Fabric-CA 서버 운영자 권한을 사용할 수 있는 MSP  

---  

<div id="organization_create"></div>

## 조직 생성 및 조직 운영자 MSP 생성  

> 기본 설정 조직 확인 및 제거(admin@ordererorg0 노드에서 실행)  

```
root@ubuntu:~/testnet# fabric-ca-client affiliation list
affiliation: .
   affiliation: org1
      affiliation: org1.department1
      affiliation: org1.department2
   affiliation: org2
      affiliation: org2.department1
root@ubuntu:~/testnet#
root@ubuntu:~/testnet#
root@ubuntu:~/testnet# fabric-ca-client affiliation remove --force org1
2019/01/23 00:24:59 [INFO] Configuration file location: /root/testnet/fabric-ca-client-config.yaml
Successfully removed affiliation: &{AffiliationInfo:{Name:org1 Affiliations:[{Name:org1.department1 Affiliations:[] Identities:[]} {Name:org1.department2 Affiliations:[] Identities:[]}] Identities:[]} CAName:}
root@ubuntu:~/testnet#
root@ubuntu:~/testnet# fabric-ca-client affiliation remove --force org2
2019/01/23 00:25:01 [INFO] Configuration file location: /root/testnet/fabric-ca-client-config.yaml
Successfully removed affiliation: &{AffiliationInfo:{Name:org2 Affiliations:[{Name:org2.department1 Affiliations:[] Identities:[]}] Identities:[]} CAName:}
```  

> 조직 추가 및 확인(admin@ordererorg0 노드에서 실행)  

```
root@ubuntu:~/testnet# fabric-ca-client affiliation add org0
root@ubuntu:~/testnet# fabric-ca-client affiliation add org1
root@ubuntu:~/testnet# fabric-ca-client affiliation add ordererorg0
root@ubuntu:~/testnet# fabric-ca-client affiliation list
affiliation: .
   affiliation: ordererorg0
   affiliation: org0
   affiliation: org1
```  

=> 각 조직의 운영자 노드에게 Fabric-CA 서버의 디지털 인증서를 다운로드  

> 디렉터리 생성 및 인증서 저장(admin@org0 노드에서 실행)  

```
root@ubuntu:~/testnet# mkdir -p /root/testnet/crypto-config/peerOrganizations/org0/msp
root@ubuntu:~/testnet# fabric-ca-client getcacert -u http://192.168.5.41:7054 -M /root/testnet/crypto-config/peerOrganizations/org0/msp
2019/01/23 00:29:37 [INFO] Configuration file location: /root/.fabric-ca-client/fabric-ca-client-config.ya
2019/01/23 00:29:37 [INFO] Stored root CA certificate at /root/testnet/crypto-config/peerOrganizations/org-7054.pem
2019/01/23 00:29:37 [INFO] Stored Issuer public key at /root/testnet/crypto-config/peerOrganizations/org0/
2019/01/23 00:29:37 [INFO] Stored Issuer revocation public key at /root/testnet/crypto-config/peerOrganizaationPublicKey
```


> 디렉터리 생성 및 인증서 저장(admin@org1 노드에서 실행)  

```
root@ubuntu:~# mkdir -p /root/testnet/crypto-config/peerOrganizations/org1/msp
root@ubuntu:~# fabric-ca-client getcacert -u http://192.168.5.41:7054 -M /root/testnet/crypto-config/peerOrganizations/org1/msp
2019/01/23 00:30:37 [INFO] Configuration file location: /root/.fabric-ca-client/fabric-ca-client-config.ya
2019/01/23 00:30:37 [INFO] Stored root CA certificate at /root/testnet/crypto-config/peerOrganizations/org-7054.pem
2019/01/23 00:30:37 [INFO] Stored Issuer public key at /root/testnet/crypto-config/peerOrganizations/org1/
2019/01/23 00:30:37 [INFO] Stored Issuer revocation public key at /root/testnet/crypto-config/peerOrganizaationPublicKey
```  

> 디렉터리 생성 및 인증서 저장(admin@ordererorg0 노드에서 실행)  

```
root@ubuntu:~/testnet# mkdir -p /root/testnet/crypto-config/ordererOrganizations/ordererorg0/msp
root@ubuntu:~/testnet# fabric-ca-client getcacert -u http://192.168.5.41:7054 -M /root/testnet/crypto-config/ordererOrganizations/ordererorg0/msp
2019/01/23 00:33:46 [INFO] Configuration file location: /root/testnet/fabric-ca-client-config.yaml
2019/01/23 00:33:46 [INFO] Stored root CA certificate at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/msp/cacerts/192-168-5-41-7054.pem
2019/01/23 00:33:46 [INFO] Stored Issuer public key at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/msp/IssuerPublicKey
2019/01/23 00:33:46 [INFO] Stored Issuer revocation public key at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/msp/IssuerRevocationPublicKey
```  

> 각 인증서이름 ip-port.pem ca.crt로 변경  
(스크립트 재사용을 위해)  

```
/root/testnet/crypto-config/peerOrganizations/org0/msp/cacerts에 있는 파일 ca.cert로 변경
```  

> #### Fabric-CA 서버의 운영자 권한을 가진 admin@ordererorg0 노드에서 각 조직의 운영자 계정 등록  

> Admin@org0 생성

```
root@ubuntu:~# vi /root/testnet/fabric-ca-client-config.yaml (line 123~130)

id:
  # Admin@org0 이름의 ID로 org0 조직의 운영자 계정을 생성
  name: Admin@org0
  type: client
  affiliation: org0
  # 현재 등록하는 계정을 사용할 수 있는 횟수(fabric-ca enrolle 명령어)
  maxenrollments: 0

  attributes:
    # Admin@org0 계정으로 등록할 수 있는 노드의 종류
    - name: hf.Registrar.Roles
      value: client,orderer,peer,user
    - name: hf.Registrar.DelegateRoles
      value: client,orderer,peer,user
    - name: hf.Registrar.Attributes
      value: "*"
    # CRL을 생성할 수 있음   
    - name: hf.GenCRL
      value: true
    - name: hf.Revoker
      value: true
    - name: hf.AffiliationMgr
      value: true
    - name: hf.IntermediateCA
      value: true
    # 운영자 권한
    - name: role
      value: admin
      ecert: true
```  

```
root@adminordererorg0:~/testnet# fabric-ca-client register --id.secret=org@password
2019/02/20 21:10:02 [INFO] Configuration file location: /root/testnet/fabric-ca-client-config.yaml
Password: org@password
```  

> Admin@org1 생성

```
root@ubuntu:~# vi /root/testnet/fabric-ca-client-config.yaml (line 123~130)

id:  
  name: Admin@org1
  type: client
  affiliation: org1  
  maxenrollments: 0

  attributes:    
    - name: hf.Registrar.Roles
      value: client,orderer,peer,user
    - name: hf.Registrar.DelegateRoles
      value: client,orderer,peer,user
    - name: hf.Registrar.Attributes
      value: "*"    
    - name: hf.GenCRL
      value: true
    - name: hf.Revoker
      value: true
    - name: hf.AffiliationMgr
      value: true
    - name: hf.IntermediateCA
      value: true    
    - name: role
      value: admin
      ecert: true
```  

```
root@ubuntu:~# fabric-ca-client register --id.secret=org1@password
2019/01/23 20:56:45 [INFO] Configuration file location: /root/testnet/fabric-ca-client-config.yaml
Password: org1@password
```  

> Admin@ordererorg0 생성  

```
root@ubuntu:~# vi /root/testnet/fabric-ca-client-config.yaml (line 123~130)

id:  
  name: Admin@ordererorg0
  type: client
  affiliation: ordererorg0  
  maxenrollments: 0

  attributes:    
    - name: hf.Registrar.Roles
      value: client,orderer,peer,user
    - name: hf.Registrar.DelegateRoles
      value: client,orderer,peer,user
    - name: hf.Registrar.Attributes
      value: "*"    
    - name: hf.GenCRL
      value: true
    - name: hf.Revoker
      value: true
    - name: hf.AffiliationMgr
      value: true
    - name: hf.IntermediateCA
      value: true    
    - name: role
      value: admin
      ecert: true
```  

```
root@adminordererorg0:~/testnet# fabric-ca-client register --id.secret=ordererorg0password
2019/02/20 21:21:40 [INFO] Configuration file location: /root/testnet/fabric-ca-client-config.yaml
Password: ordererorg0password
```   

> #### 각 조직의 운영자 노드에 MSP 생성  

> org0 조직 운영자 MSP 생성(admin@org0 노드에서 실행)  

```
root@adminorg0:~/testnet# mkdir -p /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/

root@adminorg0:~/testnet# fabric-ca-client enroll -u http://Admin@org0:org@password@192.168.5.41:7054 -H /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/
2019/02/20 21:25:07 [INFO] Created a default configuration file at /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/fabric-ca-client-config.yaml
2019/02/20 21:25:07 [INFO] generating key: &{A:ecdsa S:256}
2019/02/20 21:25:07 [INFO] encoded CSR
2019/02/20 21:25:07 [INFO] Stored client certificate at /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/msp/signcerts/cert.pem
2019/02/20 21:25:07 [INFO] Stored root CA certificate at /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/msp/cacerts/192-168-5-41-7054.pem
2019/02/20 21:25:07 [INFO] Stored Issuer public key at /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/msp/IssuerPublicKey
2019/02/20 21:25:07 [INFO] Stored Issuer revocation public key at /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/msp/IssuerRevocationPublicKey
```  

> 디지털 인증서/개인키 이름 변경 및 사용하지 않는 폴더 삭제(admin@org0 노드)  

```
root@adminorg0:~/testnet# mv /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/msp/cacerts/192-168-5-41-7054.pem /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/msp/cacerts/ca.crt

root@adminorg0:~/testnet# ll /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/msp/keystore
total 12
drwx------ 2 root root 4096 Feb 20 21:25 ./
drwx------ 6 root root 4096 Feb 20 21:25 ../
-rw------- 1 root root  241 Feb 20 21:25 76da57b41dca8c79f2563d0044433a69d28321997ae06c0d30ac46645b5e54d2_sk

root@adminorg0:~/testnet# mv /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/msp/keystore/76da57b41dca8c79f2563d0044433a69d28321997ae06c0d30ac46645b5e54d2_sk /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/msp/keystore/server.key

root@adminorg0:~/testnet# ls /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/msp/keystore/
server.key
```  

> org1 조직 운영자 MSP 생성(admin@org1 노드에서 실행)  

```
root@adminorg1:~# mkdir -p /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/

root@adminorg1:~# fabric-ca-client enroll -u http://Admin@org1:org1@password@192.168.5.41:7054 -H /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/
2019/02/20 21:36:02 [INFO] generating key: &{A:ecdsa S:256}
2019/02/20 21:36:02 [INFO] encoded CSR
2019/02/20 21:36:02 [INFO] Stored client certificate at /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/msp/signcerts/cert.pem
2019/02/20 21:36:02 [INFO] Stored root CA certificate at /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/msp/cacerts/192-168-5-41-7054.pem
2019/02/20 21:36:02 [INFO] Stored Issuer public key at /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/msp/IssuerPublicKey
2019/02/20 21:36:02 [INFO] Stored Issuer revocation public key at /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/msp/IssuerRevocationPublicKey

```

> 디지털 인증서/개인키 이름 변경 및 사용하지 않는 폴더 삭제(admin@org1 노드)  


```
root@adminorg1:~# mv /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/msp/cacerts/192-168-5-41-7054.pem /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/msp/cacerts/ca.crt

root@adminorg1:~# mv /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/msp/keystore/39cf86983ae13c78eb16b62166003ef5572b9da8adb70f2d0007eb07741bd89e_sk /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/msp/keystore/server.key

```  

> ordererorg0 조직 운영자 MSP 생성(admin@ordererorg0 노드)  

```
root@adminordererorg0:~# mkdir -p /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0

root@adminordererorg0:~# fabric-ca-client enroll -u http://Admin@ordererorg0:ordererorg0password@192.168.5.41:7054 -H /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/
2019/02/20 21:42:31 [INFO] Created a default configuration file at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/fabric-ca-client-config.yaml
2019/02/20 21:42:31 [INFO] generating key: &{A:ecdsa S:256}
2019/02/20 21:42:31 [INFO] encoded CSR
2019/02/20 21:42:32 [INFO] Stored client certificate at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/signcerts/cert.pem
2019/02/20 21:42:32 [INFO] Stored root CA certificate at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/cacerts/192-168-5-41-7054.pem
2019/02/20 21:42:32 [INFO] Stored Issuer public key at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/IssuerPublicKey
2019/02/20 21:42:32 [INFO] Stored Issuer revocation public key at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/IssuerRevocationPublicKey
```  

> 디지털 인증서/개인키 이름 변경 및 사용하지 않는 폴더 삭제(admin@ordererorg0 노드)  

```
root@adminordererorg0:~# mv /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/cacerts/192-168-5-41-7054.pem /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/cacerts/ca.crt

root@adminordererorg0:~# mv /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/keystore/f1bbbe2acf51a37ed5f6b8c05f34407ead6dbfd9ac1174df3d8afd7394ff3973_sk /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/keystore/server.key
```  

> #### 각 조직의 운영자 MSP 디렉터리에 admincerts 디렉터리 생성 후 signcerts 디렉터리에 있는 공개키 파일을 Admin@조직이름-cert.pem 이름으로 복사  

> admincerts 디렉터리 생성 후 공개키 파일 복사(admin@org0 노드)  

```
root@adminordererorg0:~# mv /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/cacerts/192-168-5-41-7054.pem /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/cacerts/ca.crt

root@adminordererorg0:~# mv /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/keystore/f1bbbe2acf51a37ed5f6b8c05f34407ead6dbfd9ac1174df3d8afd7394ff3973_sk /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/keystore/server.key

root@adminorg0:~# tree /root/testnet/crypto-config/
/root/testnet/crypto-config/
└── peerOrganizations
    └── org0
        ├── msp
        │   ├── cacerts
        │   │   └── ca.crt
        │   ├── IssuerPublicKey
        │   ├── IssuerRevocationPublicKey
        │   ├── keystore
        │   ├── signcerts
        │   └── user
        └── users
            └── Admin@org0
                ├── fabric-ca-client-config.yaml
                └── msp
                    ├── admincerts
                    │   └── Admin@org0-cert.pem
                    ├── cacerts
                    │   └── ca.crt
                    ├── IssuerPublicKey
                    ├── IssuerRevocationPublicKey
                    ├── keystore
                    │   └── server.key
                    ├── signcerts
                    │   └── cert.pem
                    └── user
```  

> admincerts 디렉터리 생성 후 공개키 파일 복사(admin@org1 노드)  

```
root@adminorg1:~# mkdir -p /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/msp/admincerts

root@adminorg1:~# cp /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/msp/signcerts/cert.pem /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/msp/admincerts/Admin@org-cert.pem

root@adminorg1:~# tree /root/testnet/crypto-config/
/root/testnet/crypto-config/
└── peerOrganizations
    └── org1
        ├── msp
        │   ├── cacerts
        │   │   └── ca.crt
        │   ├── IssuerPublicKey
        │   ├── IssuerRevocationPublicKey
        │   ├── keystore
        │   ├── signcerts
        │   └── user
        └── users
            └── Admin@org1
                ├── fabric-ca-client-config.yaml
                └── msp
                    ├── admincerts
                    │   └── Admin@org-cert.pem
                    ├── cacerts
                    │   └── ca.crt
                    ├── IssuerPublicKey
                    ├── IssuerRevocationPublicKey
                    ├── keystore
                    │   └── server.key
                    ├── signcerts
                    │   └── cert.pem
                    └── user
```  

> admincerts 디렉터리 생성 후 공개키 파일 복사(admin@ordererorg0 노드)  

```
root@adminordererorg0:~# mkdir -p /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/admincerts

root@adminordererorg0:~# cp /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/signcerts/cert.pem /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/msp/admincerts/Admin@ordererorg0-cert.pem

root@adminordererorg0:~# tree /root/testnet/crypto-config/
/root/testnet/crypto-config/
└── ordererOrganizations
    └── ordererorg0
        ├── msp
        │   ├── cacerts
        │   │   └── ca.crt
        │   ├── IssuerPublicKey
        │   ├── IssuerRevocationPublicKey
        │   ├── keystore
        │   ├── signcerts
        │   └── user
        └── users
            └── Admin@ordererorg0
                ├── fabric-ca-client-config.yaml
                └── msp
                    ├── admincerts
                    │   └── Admin@ordererorg0-cert.pem
                    ├── cacerts
                    │   └── ca.crt
                    ├── IssuerPublicKey
                    ├── IssuerRevocationPublicKey
                    ├── keystore
                    │   └── server.key
                    ├── signcerts
                    │   └── cert.pem
                    └── user

```    

---  


<div id="peer_orderer_msp_create"></div>  

## Peer 및 Orderer 노드 MSP 생성  

> peer0 계정 생성 (admin@org0에서 실행)

```
root@adminorg0:~# vi /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/fabric-ca-client-config.yaml
...
127 id:
128   name: peer0
129   type: peer
130   affiliation: org0
131   maxenrollments: 0
132   attributes:
133     - name: role
134       value: peer
135       ecert: true
:wq

root@adminorg0:~# fabric-ca-client register --id.secret=peer0password -H /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/
2019/02/24 20:48:34 [INFO] Configuration file location: /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/fabric-ca-client-config.yaml
Password: peer0password
```   

> peer1 계정 생성 (admin@org0에서 실행)

```
root@adminorg0:~# vi /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/fabric-ca-client-config.yaml
...
127 id:
128   name: peer1
129   type: peer
130   affiliation: org0
131   maxenrollments: 0
132   attributes:
133     - name: role
134       value: peer
135       ecert: true
:wq

root@adminorg0:~# fabric-ca-client register --id.secret=peer1password -H /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/
2019/02/24 20:52:43 [INFO] Configuration file location: /root/testnet/crypto-config/peerOrganizations/org0/users/Admin@org0/fabric-ca-client-config.yaml
Password: peer1password
```  

> peer2 계정 생성 (admin@org1에서 실행)  

```
root@adminorg1:~# vi /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/fabric-ca-client-config.yaml
...
127 id:
128   name: peer2
129   type: peer
130   affiliation: org1
131   maxenrollments: 0
132   attributes:
133     - name: role
134       value: peer
135       ecert: true
:wq
root@adminorg1:~# fabric-ca-client register --id.secret=peer2password -H /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/
2019/02/24 20:56:59 [INFO] Configuration file location: /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/fabric-ca-client-config.yaml
Password: peer2password
```  

> peer3 계정 생성(admin@org1에서 실행)  

```
root@adminorg1:~# vi /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/fabric-ca-client-config.yaml
...
127 id:
128   name: peer3
129   type: peer
130   affiliation: org1
131   maxenrollments: 0
132   attributes:
133     - name: role
134       value: peer
135       ecert: true
:wq
root@adminorg1:~# fabric-ca-client register --id.secret=peer3password -H /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/
2019/02/24 20:58:32 [INFO] Configuration file location: /root/testnet/crypto-config/peerOrganizations/org1/users/Admin@org1/fabric-ca-client-config.yaml
Password: peer3password
```  

> orderer0 계정 생성(admin@ordererorg0에서 실행)  

```
root@adminordererorg0:~# vi /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/fabric-ca-client-config.yaml
...
127 id:
128   name: orderer0
129   type: orderer
130   affiliation: ordererorg0
131   maxenrollments: 0
132   attributes:
133     - name: role
134       value: orderer
135       ecert: true
:wq
root@adminordererorg0:~# fabric-ca-client register --id.secret=orderer0password -H /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/
2019/02/24 21:03:08 [INFO] Configuration file location: /root/testnet/crypto-config/ordererOrganizations/ordererorg0/users/Admin@ordererorg0/fabric-ca-client-config.yaml
Password: orderer0password
```  

=> 모든 노드에서 enroll 명령어를 이용해 peer와 orderer의 MSP를 생성  

> peer0 MSP 생성 (peer0 노드에서 실행)  

```
root@peer0:~# mkdir -p /root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/

root@peer0:~# fabric-ca-client enroll -u http://peer0:peer0password@192.168.5.41:7054 -H  /root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/
2019/02/24 21:05:59 [INFO] Created a default configuration file at /root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/fabric-ca-client-config.yaml
2019/02/24 21:05:59 [INFO] generating key: &{A:ecdsa S:256}
2019/02/24 21:05:59 [INFO] encoded CSR
2019/02/24 21:06:00 [INFO] Stored client certificate at /root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/msp/signcerts/cert.pem
2019/02/24 21:06:00 [INFO] Stored root CA certificate at /root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/msp/cacerts/192-168-5-41-7054.pem
2019/02/24 21:06:00 [INFO] Stored Issuer public key at /root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/msp/IssuerPublicKey
2019/02/24 21:06:00 [INFO] Stored Issuer revocation public key at /root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/msp/IssuerRevocationPublicKey

root@peer0:~# mv /root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/msp/cacerts/192-168-5-41-7054.pem /root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/msp/cacerts/ca.crt

root@peer0:~# mv /root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/msp/keystore/794a4a4dc012fda7ac77179e5097a55f83786ce13cf36703d83776ffdff51d14_sk /root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/msp/keystore/server.key
```

> peer1 MSP 생성 (peer1 노드에서 실행)  

```
root@peer1:~# mkdir -p /root/testnet/crypto-config/peerOrganizations/org0/peers/peer1.org0/

root@peer1:~# fabric-ca-client enroll -u http://peer1:peer1password@192.168.5.41:7054 -H  /root/testnet/crypto-config/peerOrganizations/org0/peers/peer1.org0/
2019/02/24 21:09:03 [INFO] Created a default configuration file at /root/testnet/crypto-config/peerOrganizations/org0/peers/peer1.org0/fabric-ca-client-config.yaml
2019/02/24 21:09:03 [INFO] generating key: &{A:ecdsa S:256}
2019/02/24 21:09:03 [INFO] encoded CSR
2019/02/24 21:09:03 [INFO] Stored client certificate at /root/testnet/crypto-config/peerOrganizations/org0/peers/peer1.org0/msp/signcerts/cert.pem
2019/02/24 21:09:03 [INFO] Stored root CA certificate at /root/testnet/crypto-config/peerOrganizations/org0/peers/peer1.org0/msp/cacerts/192-168-5-41-7054.pem
2019/02/24 21:09:03 [INFO] Stored Issuer public key at /root/testnet/crypto-config/peerOrganizations/org0/peers/peer1.org0/msp/IssuerPublicKey
2019/02/24 21:09:03 [INFO] Stored Issuer revocation public key at /root/testnet/crypto-config/peerOrganizations/org0/peers/peer1.org0/msp/IssuerRevocationPublicKey

root@peer1:~# mv /root/testnet/crypto-config/peerOrganizations/org0/peers/peer1.org0/msp/cacerts/192-168-5-41-7054.pem /root/testnet/crypto-config/peerOrganizations/org0/peers/peer1.org0/msp/cacerts/ca.crt

root@peer1:~# mv /root/testnet/crypto-config/peerOrganizations/org0/peers/peer1.org0/msp/keystore/21da2778d0dc1d621953c4ca85230175ff997eee0a42f1fabfd6fa82a473ffd3_sk /root/testnet/crypto-config/peerOrganizations/org0/peers/peer1.org0/msp/keystore/server.key
```  

> peer2 MSP 생성 (peer2 노드에서 실행)  

```
root@peer2:~# mkdir -p /root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/

root@peer2:~# fabric-ca-client enroll -u http://peer2:peer2password@192.168.5.41:7054 -H  /root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/
2019/02/24 21:12:19 [INFO] Created a default configuration file at /root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/fabric-ca-client-config.yaml
2019/02/24 21:12:19 [INFO] generating key: &{A:ecdsa S:256}
2019/02/24 21:12:19 [INFO] encoded CSR
2019/02/24 21:12:19 [INFO] Stored client certificate at /root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/msp/signcerts/cert.pem
2019/02/24 21:12:19 [INFO] Stored root CA certificate at /root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/msp/cacerts/192-168-5-41-7054.pem
2019/02/24 21:12:19 [INFO] Stored Issuer public key at /root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/msp/IssuerPublicKey
2019/02/24 21:12:19 [INFO] Stored Issuer revocation public key at /root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/msp/IssuerRevocationPublicKey

root@peer2:~# mv /root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/msp/cacerts/192-168-5-41-7054.pem /root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/msp/cacerts/ca.crt

root@peer2:~# mv /root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/msp/keystore/21da2778d0dc1d621953c4ca85230175ff997eee0a42f1fabfd6fa82a473ffd3_sk /root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/msp/keystore/server.key
```  

> peer3 MSP 생성 (peer3 노드에서 실행)  

```
root@peer3:~# mkdir -p /root/testnet/crypto-config/peerOrganizations/org1/peers/peer3.org1/

root@peer3:~# fabric-ca-client enroll -u http://peer3:peer3password@192.168.5.41:7054 -H  /root/testnet/crypto-config/peerOrganizations/org1/peers/peer3.org1/
2019/02/24 21:18:43 [INFO] Created a default configuration file at /root/testnet/crypto-config/peerOrganizations/org1/peers/peer3.org1/fabric-ca-client-config.yaml
2019/02/24 21:18:43 [INFO] generating key: &{A:ecdsa S:256}
2019/02/24 21:18:43 [INFO] encoded CSR
2019/02/24 21:18:43 [INFO] Stored client certificate at /root/testnet/crypto-config/peerOrganizations/org1/peers/peer3.org1/msp/signcerts/cert.pem
2019/02/24 21:18:43 [INFO] Stored root CA certificate at /root/testnet/crypto-config/peerOrganizations/org1/peers/peer3.org1/msp/cacerts/192-168-5-41-7054.pem
2019/02/24 21:18:43 [INFO] Stored Issuer public key at /root/testnet/crypto-config/peerOrganizations/org1/peers/peer3.org1/msp/IssuerPublicKey
2019/02/24 21:18:43 [INFO] Stored Issuer revocation public key at /root/testnet/crypto-config/peerOrganizations/org1/peers/peer3.org1/msp/IssuerRevocationPublicKey

root@peer3:~# mv /root/testnet/crypto-config/peerOrganizations/org1/peers/peer3.org1/msp/cacerts/192-168-5-41-7054.pem /root/testnet/crypto-config/peerOrganizations/org1/peers/peer3.org1/msp/cacerts/ca.crt

root@peer3:~# mv /root/testnet/crypto-config/peerOrganizations/org1/peers/peer3.org1/msp/keystore/2866674a897dc122509ffad67b864dfdf04120c32d6b09de14bc6ed43fec07d8_sk /root/testnet/crypto-config/peerOrganizations/org1/peers/peer3.org1/msp/keystore/server.key
```  

> orderer0 MSP 생성 (orderer0 노드에서 실행)  

```
root@orderer0:~# mkdir -p /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0

root@orderer0:~# fabric-ca-client enroll -u http://orderer0:orderer0password@192.168.5.41:7054 -H /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0
2019/02/24 21:23:50 [INFO] Created a default configuration file at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/fabric-ca-client-config.yaml
2019/02/24 21:23:50 [INFO] generating key: &{A:ecdsa S:256}
2019/02/24 21:23:50 [INFO] encoded CSR
2019/02/24 21:23:50 [INFO] Stored client certificate at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/msp/signcerts/cert.pem
2019/02/24 21:23:50 [INFO] Stored root CA certificate at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/msp/cacerts/192-168-5-41-7054.pem
2019/02/24 21:23:50 [INFO] Stored Issuer public key at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/msp/IssuerPublicKey
2019/02/24 21:23:50 [INFO] Stored Issuer revocation public key at /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/msp/IssuerRevocationPublicKey

root@orderer0:~# mv /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/msp/cacerts/192-168-5-41-7054.pem /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/msp/cacerts/ca.crt

root@orderer0:~# mv /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/msp/keystore/0351160423d8ee7fbd90331fdbd24bfe6234a5532dee217e25782a6f3c8769b3_sk /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/msp/keystore/server.key
```

---  

<div id="running_orderer"></div>  

## Orderer 구동  

> configtx.yaml 파일 생성(admin@ordererorg0 노드에서 실행)    

```
Organizations:
    - &OrdererOrg0
        Name: OrdererOrg0
        ID: OrdererOrg0MSP
        MSPDir: crypto-config/ordererOrganizations/ordererorg0/msp/

    - &Org0
        Name: Org0MSP
        ID: Org0MSP
        MSPDir: crypto-config/peerOrganizations/org0/msp/
        AnchorPeers:
            - Host: peer0
              Port: 7051
    - &Org1
        Name: Org1MSP
        ID: Org1MSP
        MSPDir: crypto-config/peerOrganizations/org1/msp/
        AnchorPeers:
            - Host: peer2
              Port: 7051

Orderer: &OrdererDefaults
    OrdererType: kafka
    Addresses:
        - orderer0:7050
    BatchTimeout: 1s
    BatchSize:
        MaxMessageCount: 30
        AbsoluteMaxBytes: 99 MB
        PreferredMaxBytes: 512 KB
    Kafka:
        Brokers:
            - kafka-zookeeper:9092
    Organizations:

Application: &ApplicationDefaults
    Organizations:

Profiles:

    TwoOrgsOrdererGenesis:
        Orderer:
            <<: *OrdererDefaults
            Organizations:
                - *OrdererOrg0
        Consortiums:
            SampleConsortium:
                Organizations:
                    - *Org0
                    - *Org1

    TwoOrgsChannel:
        Consortium: SampleConsortium
        Application:
            <<: *ApplicationDefaults
            Organizations:
                - *Org0
                - *Org1
```

> perm , cert 파일(adminorg0, adminorg1) 복사

```
root@adminordererorg0:~/testnet# tree crypto-config/
crypto-config/
├── ordererOrganizations
│   └── ordererorg0
│       ├── msp
│       │   ├── admincerts
│       │   │   └── Admin@ordererorg0-cert.pem
│       │   ├── cacerts
│       │   │   └── ca.crt
│       │   ├── IssuerPublicKey
│       │   ├── IssuerRevocationPublicKey
│       │   ├── keystore
│       │   ├── signcerts
│       │   └── user
│       └── users
│           └── Admin@ordererorg0
│               ├── fabric-ca-client-config.yaml
│               └── msp
│                   ├── admincerts
│                   │   └── Admin@ordererorg0-cert.pem
│                   ├── cacerts
│                   │   └── ca.crt
│                   ├── IssuerPublicKey
│                   ├── IssuerRevocationPublicKey
│                   ├── keystore
│                   │   └── server.key
│                   ├── signcerts
│                   │   └── cert.pem
│                   └── user
└── peerOrganizations
    ├── org0
    │   └── msp
    │       ├── admincerts
    │       │   └── Admin@org0-cert.pem
    │       └── cacerts
    │           └── ca.crt
    └── org1
        └── msp
            ├── admincerts
            │   └── Admin@org-cert.pem
            └── cacerts
                └── ca.crt

25 directories, 15 files
root@adminordererorg0:~/testnet#
```  

> genesis.block 파일 생성  

```
root@adminordererorg0:~/testnet# configtxgen -profile TwoOrgsOrdererGenesis -outputBlock genesis.block

2019-02-24 22:20:48.111 PST [common/tools/configtxgen] main -> WARN 001 Omitting the channel ID for configtxgen for output operations is deprecated.  Explicitly passing the channel ID will be required in the future, defaulting to 'testchainid'.
2019-02-24 22:20:48.117 PST [common/tools/configtxgen] main -> INFO 002 Loading configuration
2019-02-24 22:20:48.123 PST [common/tools/configtxgen/encoder] NewChannelGroup -> WARN 003 Default policy emission is deprecated, please include policy specifications for the channel group in configtx.yaml
2019-02-24 22:20:48.123 PST [common/tools/configtxgen/encoder] NewOrdererGroup -> WARN 004 Default policy emission is deprecated, please include policy specifications for the orderer group in configtx.yaml
2019-02-24 22:20:48.140 PST [common/tools/configtxgen/encoder] NewOrdererOrgGroup -> WARN 005 Default policy emission is deprecated, please include policy specifications for the orderer org group OrdererOrg0 in configtx.yaml
2019-02-24 22:20:48.140 PST [common/tools/configtxgen/encoder] NewOrdererOrgGroup -> WARN 006 Default policy emission is deprecated, please include policy specifications for the orderer org group Org0MSP in configtx.yaml
2019-02-24 22:20:48.140 PST [common/tools/configtxgen/encoder] NewOrdererOrgGroup -> WARN 007 Default policy emission is deprecated, please include policy specifications for the orderer org group Org1MSP in configtx.yaml
2019-02-24 22:20:48.140 PST [common/tools/configtxgen] doOutputBlock -> INFO 008 Generating genesis block
2019-02-24 22:20:48.140 PST [common/tools/configtxgen] doOutputBlock -> INFO 009 Writing genesis block
```  

> kafka zookeeper 구동  

```
# mkdir /root/testnet
# cd testnet/
# vi docker-compose.yaml
version: '2'
services:
    zookeeper:
        image: hyperledger/fabric-zookeeper
#        restart: always
        ports:
            - "2181:2181"
    kafka0:
        image: hyperledger/fabric-kafka
#        restart: always
        environment:
            - KAFKA_ADVERTISED_HOST_NAME=10.0.1.32
            - KAFKA_ADVERTISED_PORT=9092
            - KAFKA_BROKER_ID=0
            - KAFKA_MESSAGE_MAX_BYTES=103809024 # 99 * 1024 * 1024 B
            - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024 # 99 * 1024 * 1024 B
            - KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false
            - KAFKA_NUM_REPLICA_FETCHERS=1
            - KAFKA_DEFAULT_REPLICATION_FACTOR=1
            - KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181
        ports:
            - "9092:9092"
        depends_on:
            - zookeeper
:wq

# docker-compose -f docker-compose.yaml up
```  

> orderer0 genesis.block  

```
# /root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/genesis.block
```  

> orderer0 노드 실행  

```
root@orderer0:~/testnet# tree crypto-config/
crypto-config/
└── ordererOrganizations
    └── ordererorg0
        └── orderers
            └── orderer0.ordererorg0
                ├── fabric-ca-client-config.yaml
                ├── genesis.block
                └── msp
                    ├── admincerts
                    │   └── Admin@ordererorg0-cert.pem
                    ├── cacerts
                    │   └── ca.crt
                    ├── IssuerPublicKey
                    ├── IssuerRevocationPublicKey
                    ├── keystore
                    │   └── server.key
                    ├── signcerts
                    │   └── cert.pem
                    ├── tls
                    │   ├── ca.crt
                    │   ├── server.crt
                    │   └── server.key
                    └── user

11 directories, 11 files  

# root@orderer0:~/testnet# vi runOrderer0.sh

ORDERER_GENERAL_LOGLEVEL=info \
ORDERER_GENERAL_LISTENADDRESS=orderer0 \
ORDERER_GENERAL_GENESISMETHOD=file \
ORDERER_GENERAL_GENESISFILE=/root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/genesis.block \
ORDERER_GENERAL_LOCALMSPID=OrdererOrg0MSP \
ORDERER_GENERAL_LOCALMSPDIR=/root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/msp \
ORDERER_GENERAL_TLS_ENABLED=false \
ORDERER_GENERAL_TLS_PRIVATEKEY=/root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/tls/server.key \
ORDERER_GENERAL_TLS_CERTIFICATE=/root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/tls/server.crt \
ORDERER_GENERAL_TLS_ROOTCAS=[/root/testnet/crypto-config/ordererOrganizations/ordererorg0/orderers/orderer0.ordererorg0/tls/ca.crt,/root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/tls/ca.crt,/root/testnet/crypto-config/peerOrganizations/org1/peers/peer2.org1/tls/ca.crt] \
CONFIGTX_ORDERER_BATCHTIMEOUT=1s \
CONFIGTX_ORDERER_ORDERERTYPE=kafka \
CONFIGTX_ORDERER_KAFKA_BROKERS=[kafka-zookeeper:9092] \
orderer

:wq
```    

---  

<div id="running_peer"></div>  

## Peer 구동    

```
# root@peer0:~/gopath/src/github.com/hyperledger/fabric# tree /root/testnet/
/root/testnet/
├── core.yaml
├── crypto-config
│   └── peerOrganizations
│       └── org0
│           └── peers
│               └── peer0.org0
│                   ├── fabric-ca-client-config.yaml
│                   ├── msp
│                   │   ├── admincerts
│                   │   │   └── Admin@org0-cert.pem
│                   │   ├── cacerts
│                   │   │   └── ca.crt
│                   │   ├── IssuerPublicKey
│                   │   ├── IssuerRevocationPublicKey
│                   │   ├── keystore
│                   │   │   └── server.key
│                   │   ├── signcerts
│                   │   │   └── cert.pem
│                   │   └── user
│                   └── tls
│                       ├── ca.crt
│                       ├── server.crt
│                       └── server.key

#


│                   │   ├── signcerts
│                   │   │   └── cert.pem
│                   │   └── user
│                   └── tls
│                       ├── ca.crt
│                       ├── server.crt
│                       └── server.key
├── orderer.yaml
└── runPeer0.sh

12 directories, 13 files

root@peer0:~/gopath/src/github.com/hyperledger/fabric# vi runPeer0.sh

CORE_PEER_ENDORSER_ENABLED=true \
CORE_PEER_PROFILE_ENABLED=true \
CORE_PEER_ADDRESS=192.168.5.11:7051 \
CORE_PEER_CHAINCODELISTENADDRESS=192.168.5.11:7052 \
CORE_PEER_ID=org0-peer0 \
CORE_PEER_LOCALMSPID=Org0MSP \
CORE_PEER_GOSSIP_EXTERNALENDPOINT=192.168.5.11:7051 \
CORE_PEER_GOSSIP_USELEADERELECTION=true \
CORE_PEER_GOSSIP_ORGLEADER=false \
CORE_PEER_TLS_ENABLED=false \
CORE_PEER_TLS_KEY_FILE=/root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/tls/server.key \
CORE_PEER_TLS_CERT_FILE=/root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/tls/server.crt \
CORE_PEER_TLS_ROOTCERT_FILE=/root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/tls/ca.crt \
CORE_PEER_TLS_SERVERHOSTOVERRIDE=192.168.5.11 \
CORE_VM_DOCKER_ATTACHSTDOUT=true \
CORE_PEER_MSPCONFIGPATH=/root/testnet/crypto-config/peerOrganizations/org0/peers/peer0.org0/msp \
peer node start
```  

---  

<div id="generate_channel"></div>  

## 채널 생성  

> ch1.tx 생성 후 admin@org0 노드로 전송 (admin@ordererorg0 노드에서 실행)  

```aidl
root@adminordererorg0:~/testnet# configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ch1.tx -channelID ch1
2019-02-25 01:39:07.829 PST [common/tools/configtxgen] main -> INFO 001 Loading configuration
2019-02-25 01:39:07.914 PST [common/tools/configtxgen] doOutputChannelCreateTx -> INFO 002 Generating new channel configtx
2019-02-25 01:39:07.914 PST [common/tools/configtxgen/encoder] NewApplicationGroup -> WARN 003 Default policy emission is deprecated, please include policy specifications for the application group in configtx.yaml
2019-02-25 01:39:07.915 PST [common/tools/configtxgen/encoder] NewApplicationOrgGroup -> WARN 004 Default policy emission is deprecated, please include policy specifications for the application org group Org0MSP in c
2019-02-25 01:39:07.915 PST [common/tools/configtxgen/encoder] NewApplicationOrgGroup -> WARN 005 Default policy emission is deprecated, please include policy specifications for the application org group Org1MSP in c
2019-02-25 01:39:07.936 PST [common/tools/configtxgen] doOutputChannelCreateTx -> INFO 006 Writing new channel tx

root@adminordererorg0:~/testnet# scp ch1.tx root@192.168.5.13:/home/fabric/ch1.tx
```















<br /><br /><br /><br />  

---

  
## Peer 채널 참여  

- <a href="#join_channel">채널 참여</a>  
## Peer 채널 참여  

- <a href="#update_anchor_peer">Anchor peer 업데이트</a>  
## Anchor peer 업데이트  

- <a href="#install_chaincode">체인코드 설치</a>  
## 체인코드 설치

- <a href="#instantiate_channel">체인코드 설치</a>  
## 체인코드 인스턴스 생성  

- <a href="#read_ledger">분산원장의 데이터 읽기</a>  
## 분산원장의 데이터 읽기  

- <a href="#write_ledger">분산원장의 데이터 기록</a>
## 분산원장에 데이터 기록


